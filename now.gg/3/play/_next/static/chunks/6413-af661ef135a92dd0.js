"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6413],{65663:function(e,t,r){r.d(t,{t:function(){return k}});var n=r(57981),a=r(94381),o=r(45628),s=r(38041),i=r(66971),u=r(47309),c=r(78294),l=r(2370),f=r(45918),d=r(58157),p=r(58309),h=r(79305),v=function(){return(v=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},b=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function s(e){try{u(n.next(e))}catch(t){o(t)}}function i(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}u((n=n.apply(e,t||[])).next())}))},S=function(e,t){var r,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(i){o=[6,i],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},y="authServiceHost",g="ncmHost",m=(new AbortController).signal;function w(e,t){var r=this;return function(w,k){return b(r,void 0,void 0,(function(){var r,b,A,E,Z,T,P,x,I,N,U,H,O,F,_,R;return S(this,(function(S){switch(S.label){case 0:r="",b="",A=null,S.label=1;case 1:return S.trys.push([1,16,,17]),E=t.host===y||t.host===g?t.path:(c.ZP.prefix||"")+t.path,Z=t.host===y&&!c.ZP.authUseThirdPartyFlow&&"https://".concat(c.ZP.appInfo.authServiceHost)?"https://".concat(c.ZP.appInfo.authServiceHost):t.host===g?c.ZP.ngNcmHost:window.location.origin,T=new URL(E,Z),w&&(T.search=new URLSearchParams(w).toString()),P=localStorage.getItem(a.B1),x={},P&&(x.Authorization="Bearer ".concat(P)),t.firebaseAuth?(I=(0,l.v0)(),[4,null===(_=I.currentUser)||void 0===_?void 0:_.getIdToken()]):[3,3];case 2:if(!(N=S.sent()))return[2,{status:o.YR.FailureUnauthorized}];x.firebaseAuthorization="Bearer ".concat(N),S.label=3;case 3:return U=t.authorize&&(x.Authorization||x.firebaseAuthorization)?{headers:x}:{},b=T.toString(),H=t.avoidAbortSignal?void 0:m,"GET"!==e?[3,5]:[4,fetch(b,{credentials:t.host===g?"omit":"include",headers:v({"x-ngg-fe-version":n.f4,"x-ngg-skip-evar-check":t.skipEvarCheck?t.skipEvarCheck:"true"},U.headers),signal:H})];case 4:return A=S.sent(),[3,9];case 5:return"PATCH"!==e?[3,7]:[4,fetch(b,{method:"PATCH",credentials:"include",headers:v({"content-type":"application/json","x-ngg-fe-version":n.f4},null===U||void 0===U?void 0:U.headers),body:k?JSON.stringify(k):void 0,signal:H})];case 6:return A=S.sent(),[3,9];case 7:return[4,fetch(b,{method:"POST",credentials:"include",headers:v({"content-type":"application/json","x-ngg-fe-version":n.f4,"x-ngg-skip-evar-check":t.skipEvarCheck?t.skipEvarCheck:"true"},null===U||void 0===U?void 0:U.headers),body:k?JSON.stringify(k):void 0,signal:H})];case 8:A=S.sent(),S.label=9;case 9:return 409===A.status&&u.Z.dispatch({type:i.Z.SET_ERROR,payload:{error:o.YR.FailureValidationError,clientId:"",sessionId:"",isAndroidConnected:!1,errorDescription:""}}),205!==A.status?[3,11]:(window.nggVersionMismatch=!0,[4,(0,s.gw)(1e4)]);case 10:throw S.sent(),(0,f.iI)("StartSession"),new Error("Version Mismatch");case 11:return[4,A.text()];case 12:return r=S.sent(),(O=JSON.parse(r)).status&&a.VI[O.status]&&(0,d.Z)(a.VI[O.status],"","NowggIfpSdkEvent"),401!==A.status?[3,15]:![o.YR.FailureTokenExpired,o.YR.FailureInvalidToken].includes(O.status)||A.url.includes("/accounts/auth/v1/access-token")?[3,14]:[4,(0,h.uu)(e,t,w,k)];case 13:return[2,S.sent()];case 14:return(0,s.KU)({status:O.status,url:T.toString()})?[2,O]:[2,{status:o.YR.FailureUnauthorized,errorMessage:"Http Status Code 401"}];case 15:return A.ok?t.host||O.status!==o.YR.FailureUnauthorized?!O||!O.status&&"boolean"!==typeof O.success?[2,{status:o.YR.FailureMalformedJSONResponse,errorMessage:"JSON Status ".concat(A.status)}]:[2,O]:((0,p.kS)({reason:"StatusFailureUnauthorized",url:null===(R=null===A||void 0===A?void 0:A.url)||void 0===R?void 0:R.split("?")[0]}),[2,{status:o.YR.JsonStatusFailureUnauthorized,errorMessage:"Http Status Code 401"}]):((0,n.ZP)(new Error("fetch: ".concat(b," failed, response.ok: ").concat(A.ok)),{response:A}),[2,{status:o.YR.FailureUnexpectedHttpStatusCode,errorMessage:"Http Status Code ".concat(A.status,", JSON Status: ").concat(null===O||void 0===O?void 0:O.status,", JSON Message: ").concat(null===O||void 0===O?void 0:O.errorMessage),errorData:O}]);case 16:return"AbortError"!==(F=S.sent()).name&&(0,n.ZP)("Api Failed: ".concat(F.message),{error:{e:F,type:"".concat(F.name),message:"".concat(F.message),path:"".concat(e," ").concat(t.path),finalUrl:b,responseText:r},response:A,requestData:{query:w,body:k,options:t,method:e},appState:{ngNcmHost:c.ZP.ngNcmHost,authUseThirdPartyFlow:c.ZP.authUseThirdPartyFlow,prefix:c.ZP.prefix}}),[2,{status:o.YR.FailureFeFetchException,errorMessage:t.forwardError?"".concat(F.name,": ").concat(F.message):void 0,errorStack:t.forwardError?F.stack:void 0}];case 17:return[2]}}))}))}}var k={startLiveStream:w("POST",{host:null,path:"/api/lstrm/v1/startLiveStream",authorize:!0,firebaseAuth:!0}),getAvailableLiveStream:w("GET",{host:null,path:"/api/lstrm/v1/getAvailableLiveStream",authorize:!0,firebaseAuth:!0}),viewLiveStream:w("GET",{host:null,path:"/api/lstrm/v1/viewLiveStream",authorize:!0,firebaseAuth:!0}),setLiveStreamAnswerSdp:w("POST",{host:null,path:"/api/lstrm/v1/setLiveStreamAnswerSdp",authorize:!0,firebaseAuth:!0}),getLiveStreamInfo:w("GET",{host:null,path:"/api/lstrm/v1/getLiveStreamInfo",authorize:!0,firebaseAuth:!0})}},44469:function(e,t,r){r.d(t,{Z:function(){return m}});var n=r(47309),a=r(36488),o=r(79305),s=r(45628),i=r(38041),u=r(94381),c=(r(51019),r(83977)),l=r(2370),f=r(39828),d=r(78294),p=r(57981),h=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function s(e){try{u(n.next(e))}catch(t){o(t)}}function i(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}u((n=n.apply(e,t||[])).next())}))},v=function(e,t){var r,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(i){o=[6,i],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},b=function(e){return h(void 0,void 0,void 0,(function(){var t,r,o,s,i,u,h,b,S;return v(this,(function(v){switch(v.label){case 0:return v.trys.push([0,7,,8]),t=d.ZP.firebaseConfig||"",JSON.parse(t)?(r=(0,c.ZF)(JSON.parse(t)),o=(0,l.v0)(),[4,(0,l.Fb)(o,l.aT)]):[2];case 1:v.sent(),v.label=2;case 2:return v.trys.push([2,5,,6]),[4,(0,l._p)(o,e)];case 3:return s=v.sent(),[4,null===(S=s.user)||void 0===S?void 0:S.getIdToken()];case 4:return i=v.sent(),u=(0,f.ad)(r),n.Z.dispatch({type:a.Z.OPEN_URL_POPUP,payload:{firestoreDb:u,firestoreUidToken:i}}),[3,6];case 5:return h=v.sent(),(0,p.ZP)(h),[3,6];case 6:return[3,8];case 7:return b=v.sent(),(0,p.ZP)(b),[3,8];case 8:return[2]}}))}))},S=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function s(e){try{u(n.next(e))}catch(t){o(t)}}function i(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}u((n=n.apply(e,t||[])).next())}))},y=function(e,t){var r,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(i){o=[6,i],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},g=function(e){var t=e.split(".")[1].replace("-","+").replace("_","/"),r=JSON.parse(atob(t));return{uid:r.uid,userHandle:r.claims.userHandle,userNickname:r.claims.userNickname,userAvatar:r.claims.userAvatar,expiry:r.exp}},m=function(){return S(void 0,void 0,void 0,(function(){var e,t,r,c;return y(this,(function(l){switch(l.label){case 0:return l.trys.push([0,6,,7]),e=sessionStorage.getItem(u.Kx),n.Z.getState().streaming.firebaseAuthToken?[2]:e?(t=g(e||""),new Date(1e3*t.expiry)>new Date?(n.Z.dispatch({type:a.Z.SET_FIREBASE_AUTH_TOKEN,payload:{firebaseAuthToken:e,userHandle:t.userHandle||"",userNickname:t.userNickname||"",firebaseUid:t.uid,userAvatar:t.userAvatar||""}}),[4,b(e||"")]):[3,2]):[3,2];case 1:return l.sent(),[2];case 2:return[4,o.ZP.getFirebaseAuthToken({uaSessionId:(0,i.io)(u.K3)},{})];case 3:return(r=l.sent()).status!==s.YR.Success?[3,5]:(sessionStorage.setItem(u.Kx,r.customAuthToken||""),c=g(r.customAuthToken||""),n.Z.dispatch({type:a.Z.SET_FIREBASE_AUTH_TOKEN,payload:{firebaseAuthToken:r.customAuthToken,userHandle:c.userHandle||"",userNickname:c.userNickname||"",firebaseUid:c.uid,userAvatar:c.userAvatar||""}}),[4,b(r.customAuthToken||"")]);case 4:l.sent(),l.label=5;case 5:return[3,7];case 6:return l.sent(),[3,7];case 7:return[2]}}))}))}},57683:function(e,t,r){r.d(t,{it:function(){return v},Gk:function(){return S},bG:function(){return y}});r(51019);var n,a,o,s=r(39828),i=r(47309),u=r(36488),c=r(37986),l=r(78294),f=r(58309),d=r(1568),p=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function s(e){try{u(n.next(e))}catch(t){o(t)}}function i(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,i)}u((n=n.apply(e,t||[])).next())}))},h=function(e,t){var r,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(i){o=[6,i],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},v=function(){n&&n(),a&&a(),o&&o()},b=!0,S=function e(t,r){var l=i.Z.getState().streaming.firestoreDb;if(l){b=!1,i.Z.dispatch({type:u.Z.SET_FIREBASE_AUTH_TOKEN,payload:{documentId:r,collectionId:t}}),v();var f=(0,s.IO)((0,s.hJ)(l,"".concat(t||"","/").concat(r||"","/Viewers")));n=(0,s.cf)(f,(function(e){b=!0;var t=[];e.forEach((function(e){var r=e.data();r&&"Active"===r.state&&t.push(e.id)})),i.Z.dispatch({type:u.Z.UPDATE_VIEWERS,payload:{viewers:t||[]}})}),(function(){b&&setTimeout((function(){e(t||"",r||"")}),1e3)}));var d=(0,s.IO)((0,s.hJ)(l,"".concat(t||"","/").concat(r||"","/Messages")));a=(0,s.cf)(d,(function(e){b=!0;var t=[];e.forEach((function(e){var r=e.data();r&&t.push(r)})),i.Z.dispatch({type:u.Z.UPDATE_MESSAGES,payload:{messages:t.sort((function(e,t){return parseInt(e.createdAt,10)-parseInt(t.createdAt,10)}))||[]}})}),(function(n){b&&setTimeout((function(){e(t||"",r||"")}),2e3)})),o=(0,s.cf)((0,s.JU)(l,"".concat(t||"","/").concat(r||"")),(function(e){var t,r;b=!0;var n=e.data(),a={userHandle:n.userHandle,userNickname:n.userNickname,userAvatar:n.userAvatar,isPaused:((null===(t=n.pausedAt)||void 0===t?void 0:t.seconds)||0)>((null===(r=n.resumedAt)||void 0===r?void 0:r.seconds)||0),appName:n.appName,isStopped:"Inactive"===n.state};"connected"===i.Z.getState().streaming.viewerPeerConnectionState&&i.Z.dispatch({type:u.Z.UPDATE_MESSAGES,payload:{streamerState:a.isPaused?c.W.streamPaused:c.W.none}}),(a.isStopped||a.isPaused)&&i.Z.dispatch({type:u.Z.UPDATE_MESSAGES,payload:{streamerState:c.W.streamPaused}}),i.Z.dispatch({type:u.Z.UPDATE_MESSAGES,payload:{streamInfo:a}})}),(function(n){b&&setTimeout((function(){e(t||"",r||"")}),1e3)}))}},y=function(e){return p(void 0,void 0,void 0,(function(){var t,r,n,a,o,u,p,v,b,S,y;return h(this,(function(h){switch(h.label){case 0:return t=i.Z.getState().auth.isLoggedIn?(0,f.et)():null,r=i.Z.getState().streaming.firestoreDb,n=i.Z.getState().streaming.userHandle||(null===t||void 0===t?void 0:t.handle),a=i.Z.getState().streaming.userNickname||(null===t||void 0===t?void 0:t.nickname),o=i.Z.getState().streaming.firebaseUid,u=i.Z.getState().streaming.userAvatar||(null===t||void 0===t?void 0:t.avatar),p=i.Z.getState().streaming.collectionId,v=i.Z.getState().streaming.documentId,b=i.Z.getState().streaming.streamerState,r?b!==c.W.none&&b!==c.W.streamPaused&&l.ZP.isStreamPage?[2]:(S=(0,s.hJ)(r,"".concat(p||"","/").concat(v||"","/Messages")),y=(0,d.nS)("",18).toLowerCase(),[4,(0,s.pl)((0,s.JU)(S,y),{lstrmId:v,messageId:y,text:e,userHandle:n,userNickname:a,firebaseUid:o,userAvatar:u,createdAt:Date.now()})]):[2];case 1:return h.sent(),[2]}}))}))}}}]);
//# sourceMappingURL=6413-af661ef135a92dd0.js.map